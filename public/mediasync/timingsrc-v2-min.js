!function(t,e){"function"==typeof define&&define.amd?define([],e):t.TIMINGSRC=e()}(this,function(){
/**
   * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
   * Available via the MIT or new BSD license.
   * see: http://github.com/jrburke/almond for details
   */
let t,e,n;return function(i){let o,r,s,c;const a={},u={};let h={};const l={},p=Object.prototype.hasOwnProperty,f=[].slice,y=/\.js$/;function v(t,e){return p.call(t,e)}function _(t,e){let n,i,o,r,s,c,a,u,l,p,f;const v=e&&e.split("/"),_=h.map,g=_&&_["*"]||{};if(t&&"."===t.charAt(0))if(e){for(s=(t=t.split("/")).length-1,h.nodeIdCompat&&y.test(t[s])&&(t[s]=t[s].replace(y,"")),t=v.slice(0,v.length-1).concat(t),l=0;l<t.length;l+=1)if("."===(f=t[l]))t.splice(l,1),l-=1;else if(".."===f){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((v||g)&&_){for(l=(n=t.split("/")).length;l>0;l-=1){if(i=n.slice(0,l).join("/"),v)for(p=v.length;p>0;p-=1)if((o=_[v.slice(0,p).join("/")])&&(o=o[i])){r=o,c=l;break}if(r)break;!a&&g&&g[i]&&(a=g[i],u=l)}!r&&a&&(r=a,c=u),r&&(n.splice(0,c,r),t=n.join("/"))}return t}function g(t,e){return function(){const n=f.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),r.apply(i,n.concat([t,e]))}}function d(t){return function(e){a[t]=e}}function m(t){if(v(u,t)){const e=u[t];delete u[t],l[t]=!0,o.apply(i,e)}if(!v(a,t)&&!v(l,t))throw new Error("No "+t);return a[t]}function w(t){let e;const n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}s=function(t,e){let n,i=w(t),o=i[0];return t=i[1],o&&(n=m(o=_(o,e))),o?t=n&&n.normalize?n.normalize(t,function(t){return function(e){return _(e,t)}}(e)):_(t,e):(o=(i=w(t=_(t,e)))[0],t=i[1],o&&(n=m(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},c={require:function(t){return g(t)},exports:function(t){const e=a[t];return void 0!==e?e:a[t]={}},module:function(t){return{id:t,uri:"",exports:a[t],config:function(t){return function(){return h&&h.config&&h.config[t]||{}}}(t)}}},o=function(t,e,n,o){let r,h,p,f,y;const _=[],w=typeof n;let k;if(o=o||t,"undefined"===w||"function"===w){for(e=!e.length&&n.length?["require","exports","module"]:e,y=0;y<e.length;y+=1)if("require"===(h=(f=s(e[y],o)).f))_[y]=c.require(t);else if("exports"===h)_[y]=c.exports(t),k=!0;else if("module"===h)r=_[y]=c.module(t);else if(v(a,h)||v(u,h)||v(l,h))_[y]=m(h);else{if(!f.p)throw new Error(t+" missing "+h);f.p.load(f.n,g(o,!0),d(h),{}),_[y]=a[h]}p=n?n.apply(a[t],_):void 0,t&&(r&&r.exports!==i&&r.exports!==a[t]?a[t]=r.exports:p===i&&k||(a[t]=p))}else t&&(a[t]=n)},t=e=r=function(t,e,n,a,u){if("string"==typeof t)return c[t]?c[t](e):m(s(t,e).f);if(!t.splice){if((h=t).deps&&r(h.deps,h.callback),!e)return;e.splice?(t=e,e=n,n=null):t=i}return e=e||function(){},"function"==typeof n&&(n=a,a=u),a?o(i,t,e,n):setTimeout(function(){o(i,t,e,n)},4),r},r.config=function(t){return r(t)},t._defined=a,(n=function(t,e,n){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(n=e,e=[]),v(a,t)||v(u,t)||(u[t]=[t,e,n])}).amd={jQuery:!0}}(),n("../build/almond",function(){}),n("util/eventify",[],function(){"use strict";const t=function(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return function(t){t=t||10;let n="";for(let i=0;i<t;i++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}}();function e(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t))throw new Error("illegal parameter a, array not supported",t);if(Array.isArray(e))throw new Error("illegal parameter b, array not supported",e);if("object"==typeof t&&"object"==typeof e){const n=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(e);if(n.length!=i.length)return!1;for(let i=0;i<n.length;i++){const o=n[i];if(t[o]!==e[o])return!1}return!0}return!1}const n=function(){this._id=0,this._map={}};n.prototype._newID=function(){return this._id+=1,this._id},n.prototype._getID=function(t){let e;const n=Object.keys(this._map).filter(function(n){return(e=this._map[n]).handler===t},this);return n.length>0?n[0]:-1},n.prototype.getItem=function(t){return this._map[t]},n.prototype.register=function(t,e){let n=this._getID(t);if(n>-1)throw new Error("handler already registered");return n=this._newID(),this._map[n]={ID:n,handler:t,ctx:e,count:0,pending:!1},n},n.prototype.unregister=function(t){const e=this._getID(t);-1!==e&&delete this._map[e]},n.prototype.getItems=function(){return Object.keys(this._map).map(function(t){return this.getItem(t)},this)};const i=function(e){return e._ID=t(4),e._callbacks={},e._immediateCallbacks=[],e._eBuffer=[],e._callbacks.events=new n,e._callbacks.events._options={init:!0},e},o=function(t){t.eventifyDefineEvent=function(t,e){if("events"===t)throw new Error("Illegal event type : 'events' is protected");(e=e||{}).init=void 0!==e.init&&e.init,this._callbacks[t]=new n,this._callbacks[t]._options=e},t._eventifyMakeEItemList=function(t){return(this.eventifyMakeInitEvents||function(t){return[]}).call(this,t).map(function(e){return{type:t,e:e}})},t._eventifyMakeInitEvents=function(t){if("events"!==t)return this._eventifyMakeEItemList(t);return function(t,e,n){const i=[];return t.forEach(function(t){i.push.apply(i,e.call(n,t))},n),i}(Object.keys(this._callbacks).filter(function(t){return"events"!==t&&!0===this._callbacks[t]._options.init},this),function(t){return this._eventifyMakeEItemList(t)},this)},t._eventifyEventFormatter=function(t,e){const n=this.eventifyEventFormatter||function(t,e){return e};return"events"===t&&(e=e.map(function(t){return{type:t.type,e:n(t.type,t.e)}})),n(t,e)},t._eventifyCallbackFormatter=function(t,e,n){return(this.eventifyCallbackFormatter||function(t,e,n){return[e]}).call(this,t,e,n)},t.eventifyTriggerEvents=function(t){if(t.forEach(function(t){if(void 0===t.type)throw new Error("Illegal event type; undefined");if("events"===t.type)throw new Error("Illegal event type; triggering of events on protocted event type 'events'")},this),0===t.length)return this;if(this._eBuffer.push.apply(this._eBuffer,t),this._eBuffer.length===t.length){const t=this;Promise.resolve().then(function(){t._eventifyTriggerProtectedEvents(t._eBuffer),t._eventifyTriggerRegularEvents(t._eBuffer),t._eBuffer=[],t._eventifyFlushImmediateCallbacks()})}return this},t.eventifyTriggerEvent=function(t,e){return this.eventifyTriggerEvents([{type:t,e:e}])},t._eventifyTriggerProtectedEvents=function(t,e){this._eventifyTriggerEvent("events",t,e)},t._eventifyTriggerRegularEvents=function(t,e){t.forEach(function(t){this._eventifyTriggerEvent(t.type,t.e,e)},this)},t._eventifyTriggerEvent=function(t,e,n){let i;const o={};if(!this._callbacks.hasOwnProperty(t))throw new Error("Unsupported event type "+t);const r=this._callbacks[t],s=r._options.init;return r.getItems().forEach(function(r){if(void 0===n){if(r.pending)return!1}else{if(r.ID!==n)return!1;o.init=!0,r.pending=!1}s&&(o.init=r.ID===n),o.count=r.count,o.src=this,e=this._eventifyEventFormatter(t,e),i=this._eventifyCallbackFormatter(t,e,o);try{return r.handler.apply(r.ctx,i),r.count+=1,!0}catch(e){console.log("Error in "+t+": "+r.handler+" "+r.ctx+": ",e)}},this),!1},t.on=function(t,e,n){if(!e||"function"!=typeof e)throw new Error("Illegal handler");if(!this._callbacks.hasOwnProperty(t))throw new Error("Unsupported event type "+t);const i=this._callbacks[t];n=n||this;const o=i.register(e,n);if(i._options.init){const e=i.getItem(o);e.pending=!0;const n=this,r=function(){const i=n._eventifyMakeInitEvents(t);i.length>0?"events"===t?n._eventifyTriggerProtectedEvents(i,o):n._eventifyTriggerRegularEvents(i,o):e.pending=!1};this._immediateCallbacks.push(r),Promise.resolve().then(function(){n._eventifyFlushImmediateCallbacks()})}return this},t._eventifyFlushImmediateCallbacks=function(){if(0===this._eBuffer.length){const t=this._immediateCallbacks;this._immediateCallbacks=[],t.forEach(function(t){t()})}},t.off=function(t,e){if(void 0!==this._callbacks[t]){this._callbacks[t].unregister(e)}return this}},r=function(){i(this)};o(r.prototype),r.inherit=function(t,e){const n=function(){};n.prototype=e.prototype,t.prototype=new n,t.uber=e.prototype,t.prototype.constructor=t};var s=function(t,e){if(!(this instanceof s))throw new Error("Contructor function called without new operation");r.call(this),this._value=!!t,this.eventifyDefineEvent("change",e)};r.inherit(s,r),s.prototype.eventifyMakeInitEvents=function(t){return"change"===t?[this._value]:[]},Object.defineProperty(s.prototype,"value",{get:function(){return this._value},set:function(t){return this.set(t)}}),s.prototype.get=function(){return this._value},s.prototype.set=function(t){return(t=!!t)!==this._value&&(this._value=t,this.eventifyTriggerEvent("change",t),!0)},s.prototype.toggle=function(){const t=!this._value;return this._value=t,this.eventifyTriggerEvent("change",t),!0};const c=function(t,n){(n=n||{}).eqFunc=n.eqFunc||e,this._options=n,r.call(this),this._value=t,this._src,this.eventifyDefineEvent("change",n);const i=this;this._onSrcChange=function(t){i.set(t)}};r.inherit(c,r),c.prototype.eventifyMakeInitEvents=function(t){return"change"===t?[this._value]:[]},Object.defineProperty(c.prototype,"value",{get:function(){return this._value},set:function(t){void 0===this._src?this.set(t):this._src.value=t}}),Object.defineProperty(c.prototype,"src",{get:function(){return this._src},set:function(t){this._src&&this._src.off("change",this._onSrcChange),this._src=t,this._src.on("change",this._onSrcChange)}}),c.prototype.get=function(){return this._value},c.prototype.set=function(t){return!(0,this._options.eqFunc)(t,this._value)&&(this._value=t,this.eventifyTriggerEvent("change",t),!0)};return{eventifyPrototype:o,eventifyInstance:i,BaseEventObject:r,EventVariable:c,EventBoolean:s,makeEventPromise:function(t,e){return e=void 0===e||e,new Promise(function(n,i){var o=function(i){i===e&&(n(),t.off("change",o))};t.on("change",o)})}}}),n("util/motionutils",[],function(){"use strict";!function(){function t(t,e,n){return void 0===n||0==+n?Math[t](e):(e=+e,n=+n,isNaN(e)||"number"!=typeof n||n%1!=0?NaN:(e=e.toString().split("e"),+((e=(e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-n:-n)))).toString().split("e"))[0]+"e"+(e[1]?+e[1]+n:n))))}Math.round10||(Math.round10=function(e,n){return t("round",e,n)}),Math.floor10||(Math.floor10=function(e,n){return t("floor",e,n)}),Math.ceil10||(Math.ceil10=function(e,n){return t("ceil",e,n)})}();const t=function(t,e){if(void 0===e)throw new Error("no ts provided for calculateVector");const n=e-t.timestamp;return{position:t.position+t.velocity*n+.5*t.acceleration*n*n,velocity:t.velocity+t.acceleration*n,acceleration:t.acceleration,timestamp:e}},e=Object.freeze({INIT:"init",INSIDE:"inside",OUTSIDE_LOW:"outsidelow",OUTSIDE_HIGH:"outsidehigh"}),n=function(t,n){const i=t.position,o=t.velocity,r=t.acceleration;if(i>n[1])return e.OUTSIDE_HIGH;if(i<n[0])return e.OUTSIDE_LOW;if(i===n[1]){if(o>0)return e.OUTSIDE_HIGH;if(0===o&&r>0)return e.OUTSIDE_HIGH}else if(i===n[0]){if(o<0)return e.OUTSIDE_LOW;if(0==o&&r<0)return e.OUTSIDE_HIGH}return e.INSIDE},i=function(t,e){return t>e?1:t===e?0:t<e?-1:void 0},o=function(t,e,n,i){return Math.pow(e,2)-2*n*(t-i)>=0},r=function(t,e,n,i){if(0===n&&0===e)return t!=i?[]:[0];if(0===n)return[(i-t)/e];if(!1===o(t,e,n,i))return[];if(0===e*e-2*n*(t-i))return[-e/n];const r=Math.sqrt(Math.pow(e,2)-2*n*(t-i)),s=(-e+r)/n,c=(-e-r)/n;return[Math.min(s,c),Math.max(s,c)]},s=function(t,e){const n=function(t,e,n,i){const o=r(t,e,n,i);return 0===o.length?[]:1==o.length?o[0]>0?[o[0]]:[]:2==o.length?o[1]<0?[]:o[0]>0?[o[0],o[1]]:o[1]>0?[o[1]]:[]:[]}(t.position,t.velocity,t.acceleration,e);return 0===n.length?null:n[0]},c=function(t,e){return t[0]-e[0]};return{calculateVector:t,calculateDirection:function(e,n){const o=t(e,n);let r=i(o.velocity,0);return 0===r&&(r=i(e.acceleration,0)),r},calculateMinPositiveRealSolution:s,calculateDelta:function(t,e){const n=s(t,e[0]),i=s(t,e[1]);return null!==n&&null!==i?n<i?[n,e[0]]:[i,e[1]]:null!==n?[n,e[0]]:null!==i?[i,e[1]]:[null,null]},calculateInterval:function(t,e){const n=t.position,i=t.velocity,o=t.acceleration,r=n+i*e+.5*o*e*e;if(0!==o){const t=-i/o;if(t>=0&&t<=d){const t=n-.5*i*i/o;return o>0?[t,Math.max(n,r)]:[Math.min(n,r),t]}}return[Math.min(n,r),Math.max(n,r)]},calculateSolutionsInInterval:function(t,e,n){e=Math.round10(e,-10);const i=[],s=t.position,a=t.velocity,u=t.acceleration;for(let t=0;t<n.length;t++){const c=n[t];if(!o(s,a,u,c.point))continue;const h=r(s,a,u,c.point);for(let t=0;t<h.length;t++){let n=h[t];(n=Math.round10(n,-10))>=0&&n<=e?i.push([n,c]):console.log("dropping event : 0<t<deltaSec is not true",n,e)}}return i.sort(c),i},calculateSolutionsInInterval2:function(t,e,n){const i=[],s=t.position,a=t.velocity,u=t.acceleration;for(let t=0;t<n.length;t++){const c=n[t];if(!o(s,a,u,c.point))continue;const h=r(s,a,u,c.point);for(let t=0;t<h.length;t++){const n=h[t];n>=0&&n<=e&&i.push([n,c])}}return i.sort(c),i},getCorrectRangeState:n,checkRange:function(t,i){const o=n(t,i);return o!==e.INSIDE&&(t.velocity=0,t.acceleration=0,o===e.OUTSIDE_HIGH?t.position=i[1]:t.position=i[0]),t},RangeState:e}}),n("util/timeoututils",[],function(){"use strict";const t=function(t,e,n,i){this._clock=t;const o=this._clock.now();this._tid=null,this._callback=e,this._delay_counter=0,this._options=i||{},this._options.anchor=this._options.anchor||o,this._options.early=Math.abs(this._options.early)||0,this._target=this._options.anchor+n;const r=this;window.addEventListener("message",this,!0);const s=this._target-this._clock.now();this._tid=s>10?setTimeout(function(){r._ontimeout()},s-3e3):setTimeout(function(){r._ontimeout()},1e3*(s-r._options.early))};return Object.defineProperty(t.prototype,"target",{get:function(){return this._target}}),t.prototype._ontimeout=function(){if(null!==this._tid){const t=this._target-this._clock.now();if(t<=0)this.cancel(),this._callback();else if(t>this._options.early){const e=this;this._tid=setTimeout(function(){e._ontimeout()},1e3*(t-this._options.early))}else this._smalldelay()}},t.prototype.handleEvent=function(t){if(t.source===window&&t.data.indexOf&&0===t.data.indexOf("smalldelaymsg_")){t.stopPropagation();const e=parseInt(t.data.split("_")[1]);null!==this._tid&&this._tid===e&&this._ontimeout()}},t.prototype._smalldelay=function(){this._delay_counter++;window.postMessage("smalldelaymsg_"+this._tid,"*")},t.prototype.cancel=function(){if(null!==this._tid){clearTimeout(this._tid),this._tid=null;window.removeEventListener("message",this,!0)}},{setTimeout:function(e,n,i,o){return new t(e,n,i,o)}}}),n("util/masterclock",["./eventify","./timeoututils"],function(t,e){"use strict";"performance"in window==0&&(window.performance={},window.performance.offset=(new Date).getTime()),"now"in window.performance==0&&(window.performance.now=function(){return(new Date).getTime()-window.performance.offset});const n=function(){return performance.now()/1e3},i=function(t,e){void 0===e&&(e=n());const i=e-t.timestamp;return{position:t.position+t.velocity*i,velocity:t.velocity,timestamp:e}},o=function(e){const i=n();e=e||{},this._vector={position:i,velocity:1,timestamp:i},t.eventifyInstance(this),this.eventifyDefineEvent("change"),this.adjust(e)};return t.eventifyPrototype(o.prototype),o.prototype.adjust=function(t){t=t||{};const e=n(),i=this.query(e);void 0===t.skew&&void 0===t.rate||(this._vector={position:void 0!==t.skew?e+t.skew:i.position,velocity:void 0!==t.rate?t.rate:i.velocity,timestamp:i.timestamp},this.eventifyTriggerEvent("change"))},o.prototype.now=function(){return i(this._vector,n()).position},o.prototype.query=function(t){return i(this._vector,t)},o.prototype.setTimeout=function(t,n,i){return e.setTimeout(this,t,n,i)},o}),n("timingobject/timingobject",["../util/eventify","../util/motionutils","../util/masterclock"],function(t,e,n){"use strict";const i=function(t,e){const n=function(){};n.prototype=e.prototype,t.prototype=new n,t.uber=e.prototype,t.prototype.constructor=t};"performance"in window==0&&(window.performance={},window.performance.offset=(new Date).getTime()),"now"in window.performance==0&&(window.performance.now=function(){return(new Date).getTime()-window.performance.offset});const o=function(e){this._options=e||{},this._vector={position:void 0,velocity:void 0,acceleration:void 0,timestamp:void 0},this._event_variables=[],this._range=[void 0,void 0],this._ready=new t.EventBoolean(!1,{init:!0}),t.eventifyInstance(this),this.eventifyDefineEvent("change",{init:!0}),this.eventifyDefineEvent("timeupdate",{init:!0}),this._timeout=null,this._tid=null,this._options.hasOwnProperty("timeout")||(this._options.timeout=!1)};t.eventifyPrototype(o.prototype),o.prototype.eventifyMakeInitEvents=function(t){return"change"===t?!0===this._ready.value?[void 0]:[]:"timeupdate"===t&&!0===this._ready.value?[void 0]:[]},Object.defineProperty(o.prototype,"version",{get:function(){return this._version}}),o.prototype.isReady=function(){return this._ready.value},Object.defineProperty(o.prototype,"ready",{get:function(){const t=this;return new Promise(function(e,n){if(!0===t._ready.value)e();else{var i=function(){!0===t._ready.value&&(t._ready.off("change",i),e())};t._ready.on("change",i)}})}}),Object.defineProperty(o.prototype,"range",{get:function(){return[this._range[0],this._range[1]]}}),Object.defineProperty(o.prototype,"vector",{get:function(){return{position:this._vector.position,velocity:this._vector.velocity,acceleration:this._vector.acceleration,timestamp:this._vector.timestamp}}}),Object.defineProperty(o.prototype,"clock",{get:function(){throw new Error("not implemented")}}),o.prototype.query=function(){if(!1===this._ready.value)return{position:void 0,velocity:void 0,acceleration:void 0,timestamp:void 0};const t=e.calculateVector(this._vector,this.clock.now());return e.getCorrectRangeState(t,this._range)!==e.RangeState.INSIDE&&null!==this._timeout&&this._preProcess(t),e.calculateVector(this._vector,this.clock.now())},o.prototype.update=function(t){throw new Error("not implemented")},o.prototype.checkUpdateVector=function(t){if(null==t)throw new Error("drop update, illegal updatevector");let n=t.position,i=t.velocity,o=t.acceleration;if(null==n&&null==i&&null==o)throw new Error("drop update, noop");let r=0,s=0,c=0;const a=t.timestamp||this.clock.now();if(this.isReady()){let t=e.calculateVector(this._vector,a);r=(t=e.checkRange(t,this._range)).position,s=t.velocity,c=t.acceleration}return{position:n=null!=n?n:r,velocity:i=null!=i?i:s,acceleration:o=null!=o?o:c,timestamp:a}},Object.defineProperty(o.prototype,"pos",{get:function(){return this.query().position}}),Object.defineProperty(o.prototype,"vel",{get:function(){return this.query().velocity}}),Object.defineProperty(o.prototype,"acc",{get:function(){return this.query().acceleration}}),o.prototype._preProcess=function(t){t=this.onVectorChange(t),this._process(t)},o.prototype.onRangeChange=function(t){return t},o.prototype.onVectorChange=function(t){return e.checkRange(t,this._range)},o.prototype._process=function(t){if(null!==t){this._vector;this._vector=t,this._ready.value=!0,this._event_variables.forEach(function(t){t.set(!0)}),this._event_variables=[],this._postProcess(this._vector)}this._renewTimeout()},o.prototype._postProcess=function(t){this.eventifyTriggerEvent("change"),this.eventifyTriggerEvent("timeupdate");const e=0!==t.velocity||0!==t.acceleration;if(e&&null===this._tid){const t=this;this._tid=setInterval(function(){t.eventifyTriggerEvent("timeupdate")},200)}else e||null===this._tid||(clearTimeout(this._tid),this._tid=null)},o.prototype._renewTimeout=function(){if(!0===this._options.timeout){this._clearTimeout();const t=this._calculateTimeoutVector();if(null===t)return;const e=this.clock.now(),n=t.timestamp-e,i=this;this._timeout=this.clock.setTimeout(function(){i._process(i.onTimeout(t))},n,{anchor:e,early:.005})}},o.prototype._calculateTimeoutVector=function(){const t=this.query(),n=e.calculateDelta(t,this._range),i=n[0];if(null===i)return null;if(i===1/0)return null;const o=n[1],r=e.calculateVector(t,t.timestamp+i);return r.position=o,r},o.prototype._clearTimeout=function(){null!==this._timeout&&(this._timeout.cancel(),this._timeout=null)},o.prototype.onTimeout=function(t){return e.checkRange(t,this._range)};const r=function(t){(t=t||{}).timeout=!0,o.call(this,t),this._clock=new n({skew:0}),this._range=this._options.range||[-1/0,1/0];const e=this._options.vector||{position:0,velocity:0,acceleration:0};this.update(e)};i(r,o),Object.defineProperty(r.prototype,"clock",{get:function(){return this._clock}}),r.prototype.update=function(e){const n=this.checkUpdateVector(e),i=new t.EventBoolean;return this._event_variables.push(i),this._preProcess(n),t.makeEventPromise(i)};const s=function(t,e){(e=e||{}).timeout=!0,o.call(this),this._provider=t,this._provider_clock,this._clock;var n=this;if(this._provider.on("vectorchange",function(){n._onVectorChange()}),this._provider.on("skewchange",function(){n._onSkewChange()}),null!=this._provider.skew){n=this;Promise.resolve(function(){n._onSkewChange()})}};i(s,o),Object.defineProperty(s.prototype,"clock",{get:function(){return this._clock}}),Object.defineProperty(s.prototype,"provider",{get:function(){return this._provider}}),s.prototype._onSkewChange=function(){if(this._clock){this._provider_clock.adjust({skew:this._provider.skew});const t=this._provider_clock.now()-this._clock.now(),e=this._provider.skew-t;this._clock.adjust({skew:e})}else this._provider_clock=new n({skew:this._provider.skew}),this._clock=new n({skew:0});this.isReady()||null==this._provider.vector||(this._range=this._provider.range,this._preProcess(this._provider.vector))},s.prototype._onVectorChange=function(){this._clock&&(this._range||(this._range=this._provider.range),this._preProcess(this._provider.vector))},s.prototype.onVectorChange=function(t){const e=t.timestamp-this._provider.skew;return{position:t.position,velocity:t.velocity,acceleration:t.acceleration,timestamp:e}},s.prototype.update=function(t){return this._provider.update(t)};const c=function(t,e){o.call(this,e),this._version=4;const n=this;this._internalOnChange=function(){const t=n._timingsrc.vector;n._preProcess(t)},this._timingsrc=void 0,this.timingsrc=t};i(c,o),c.inherit=i,Object.defineProperty(c.prototype,"clock",{get:function(){return this._timingsrc.clock}}),c.prototype.onRangeChange=function(t){return t},c.prototype.onSwitch=function(){},Object.defineProperty(c.prototype,"timingsrc",{get:function(){return this._timingsrc instanceof r?void 0:this._timingsrc instanceof s?this._timingsrc.provider:this._timingsrc},set:function(t){if(t){if(t instanceof c==!1)try{t=new s(t)}catch(e){throw console.log(t),new Error("illegal timingsrc - not instance of timing object base and not timing provider")}}else{let e;e=this._timingsrc?{vector:this._vector,range:this._range}:{vector:this._options.vector,range:this._options.range},t=new r(e)}const e=this,n=function(){e._timingsrc&&e._timingsrc.off("change",e._internalOnChange),e._timingsrc=t,e._timingsrc.range!==e._range&&(e._range=e.onRangeChange(e._timingsrc.range)),e.onSwitch(),e._timingsrc.on("change",e._internalOnChange)};t.isReady()?n():t.ready.then(function(){n()})}}),c.prototype.update=function(t){return this._timingsrc.update(t)};const a=function(t){const e=(t=t||{}).timingsrc||t.provider;c.call(this,e,t)};return i(a,c),{InternalProvider:r,ExternalProvider:s,TimingObjectBase:c,TimingObject:a}}),n("timingobject/skewconverter",["./timingobject"],function(t){"use strict";const e=t.TimingObjectBase,n=e.inherit;var i=function(t,n,o){if(!(this instanceof i))throw new Error("Contructor function called without new operation");this._skew=n,e.call(this,t,o)};return n(i,e),i.prototype.onRangeChange=function(t){return t[0]=t[0]===-1/0?t[0]:t[0]+this._skew,t[1]=t[1]===1/0?t[1]:t[1]+this._skew,t},i.prototype.onVectorChange=function(t){return t.position+=this._skew,t},i.prototype.update=function(t){return void 0!==t.position&&null!==t.position&&(t.position=t.position-this._skew),this.timingsrc.update(t)},Object.defineProperty(i.prototype,"skew",{get:function(){return this._skew},set:function(t){this._skew=t;const e=this.timingsrc.vector;this._preProcess(e)}}),i}),n("timingobject/delayconverter",["./timingobject"],function(t){"use strict";const e=t.TimingObjectBase,n=e.inherit;var i=function(t,n){if(!(this instanceof i))throw new Error("Contructor function called without new operation");if(n<0)throw new Error("negative delay not supported");if(0===n)throw new Error("zero delay makes delayconverter pointless");e.call(this,t),this._delay=n};return n(i,e),i.prototype.onVectorChange=function(t){const e=this.clock.now()-t.timestamp;if(t.timestamp+=this._delay,e<this._delay){const n=this,i=1e3*(this._delay-e);return setTimeout(function(){n._process(t)},i),null}return t},i.prototype.update=function(t){throw new Error("update is not legal on delayed (non-live) timingobject")},i}),n("timingobject/scaleconverter",["./timingobject"],function(t){"use strict";const e=t.TimingObjectBase,n=e.inherit;var i=function(t,n){if(!(this instanceof i))throw new Error("Contructor function called without new operation");this._factor=n,e.call(this,t)};return n(i,e),i.prototype.onRangeChange=function(t){return[t[0]*this._factor,t[1]*this._factor]},i.prototype.onVectorChange=function(t){return t.position=t.position*this._factor,t.velocity=t.velocity*this._factor,t.acceleration=t.acceleration*this._factor,t},i.prototype.update=function(t){return void 0!==t.position&&null!==t.position&&(t.position=t.position/this._factor),void 0!==t.velocity&&null!==t.velocity&&(t.velocity=t.velocity/this._factor),void 0!==t.acceleration&&null!==t.acceleration&&(t.acceleration=t.acceleration/this._factor),this.timingsrc.update(t)},i}),n("timingobject/loopconverter",["../util/motionutils","./timingobject"],function(t,e){"use strict";const n=e.TimingObjectBase,i=n.inherit,o=function(t,e){this.skew=t,this.length=e};o.mod=function(t,e){return(t%e+e)%e},o.prototype.getPoint=function(t){return{n:Math.floor((t-this.skew)/this.length),offset:o.mod(t-this.skew,this.length)}},o.prototype.getFloat=function(t){return this.skew+t.n*this.length+t.offset},o.prototype.transformFloat=function(t,e){e=void 0===e?this.skew:e;const n=this.getPoint(t),i=this.getPoint(e);return this.getFloat({n:i.n,offset:n.offset})};var r=function(t,e){if(!(this instanceof r))throw new Error("Contructor function called without new operation");n.call(this,t,{timeout:!0}),this._range=e,this._coords=new o(e[0],e[1]-e[0])};return i(r,n),r.prototype._transform=function(t){return this._coords.transformFloat(t)},r.prototype._inverse=function(t){return t-this.query().position+this.timingsrc.query().position},r.prototype.query=function(){if(null===this.vector)return{position:void 0,velocity:void 0,acceleration:void 0};const e=t.calculateVector(this.vector,this.clock.now());if(e.position>this._range[1])this._process(this._calculateInitialVector());else{if(!(e.position<this._range[0]))return e;this._process(this._calculateInitialVector())}return t.calculateVector(this.vector,this.clock.now())},r.prototype.update=function(t){return void 0!==t.position&&null!==t.position&&(t.position=this._inverse(t.position)),this.timingsrc.update(t)},r.prototype._calculateTimeoutVector=function(){const e=this.query(),n=t.calculateDelta(e,this.range),i=n[0];if(null===i)return null;const o=n[1],r=t.calculateVector(e,e.timestamp+i);return r.position=o,r},r.prototype.onRangeChange=function(t){return this._range},r.prototype.onTimeout=function(t){return this._calculateInitialVector()},r.prototype.onVectorChange=function(t){return this._calculateInitialVector()},r.prototype._calculateInitialVector=function(){const t=this.timingsrc.query();return{position:this._transform(t.position),velocity:t.velocity,acceleration:t.acceleration,timestamp:t.timestamp}},r}),n("timingobject/rangeconverter",["../util/motionutils","./timingobject"],function(t,e){"use strict";const n=e.TimingObjectBase,i=n.inherit,o=t.RangeState,r=function(){let t=o.INIT,e=null;return{get:function(){return t},set:function(n,i){let r=!1,s=!1;return n===t&&i===e||(r=!0),n!==t&&(s=function(t,e){return!(t===o.OUTSIDE_HIGH&&e===o.OUTSIDE_LOW||t===o.OUTSIDE_LOW&&e===o.OUTSIDE_HIGH||t===o.INIT)}(t,n)),i!==e&&(e=i),n!==t&&(t=n),{special:s,absolute:r}}}};var s=function(t,e){if(!(this instanceof s))throw new Error("Contructor function called without new operation");n.call(this,t,{timeout:!0}),this._state=r(),this._range=e};return i(s,n),s.prototype.query=function(){if(!1===this._ready.value)return{position:void 0,velocity:void 0,acceleration:void 0,timestamp:void 0};const e=t.calculateVector(this._timingsrc.vector,this.clock.now());return t.getCorrectRangeState(e,this._range)!==t.RangeState.INSIDE&&null!==this._timeout&&this._preProcess(e),t.calculateVector(this._vector,this.clock.now())},s.prototype._calculateTimeoutVector=function(){const e=this._timingsrc.query(),n=t.calculateDelta(e,this.range),i=n[0];if(null===i)return null;const o=n[1],r=t.calculateVector(e,e.timestamp+i);return r.position=o,r},Object.defineProperty(s.prototype,"range",{get:function(){return[this._range[0],this._range[1]]},set:function(t){this._range=t,this._preProcess(this.timingsrc.vector)}}),s.prototype.onRangeChange=function(t){return this._range},s.prototype.onTimeout=function(t){return this.onVectorChange(t)},s.prototype.onVectorChange=function(e){const n=t.getCorrectRangeState(e,this._range),i=this._state.set(n,this._range);if(i.special)this._state.get()===o.INSIDE||(e=t.checkRange(e,this._range));else if(this._state.get()===o.INSIDE);else{if(!i.absolute)return null;e=t.checkRange(e,this._range)}return e},s}),n("timingobject/timeshiftconverter",["../util/motionutils","./timingobject"],function(t,e){"use strict";const n=e.TimingObjectBase,i=n.inherit;var o=function(t,e){if(!(this instanceof o))throw new Error("Contructor function called without new operation");n.call(this,t),this._timeOffset=e};return i(o,n),o.prototype.onRangeChange=function(t){return[-1/0,1/0]},o.prototype.onVectorChange=function(e){const n=t.calculateVector(e,e.timestamp+this._timeOffset);return n.timestamp=e.timestamp,n},o}),n("timingobject/derivativeconverter",["./timingobject"],function(t){"use strict";const e=t.TimingObjectBase,n=e.inherit;var i=function(t){if(!(this instanceof i))throw new Error("Contructor function called without new operation");e.call(this,t)};return n(i,e),i.prototype.onRangeChange=function(t){return[-1/0,1/0]},i.prototype.onVectorChange=function(t){return{position:t.velocity,velocity:t.acceleration,acceleration:0,timestamp:t.timestamp}},i.prototype.update=function(t){throw new Error("updates illegal on derivative of timingobject")},i}),n("timingobject/main",["./timingobject","./skewconverter","./delayconverter","./scaleconverter","./loopconverter","./rangeconverter","./timeshiftconverter","./derivativeconverter"],function(t,e,n,i,o,r,s,c){"use strict";return{TimingObjectBase:t.TimingObjectBase,InternalProvider:t.InternalProvider,ExternalProvider:t.ExternalProvider,TimingObject:t.TimingObject,SkewConverter:e,DelayConverter:n,ScaleConverter:i,LoopConverter:o,RangeConverter:r,TimeShiftConverter:s,DerivativeConverter:c}}),n("util/interval",[],function(){"use strict";const t=function(t){const e=parseFloat(t);return t===e&&!isNaN(e)},e=function(t){this.name="IntervalError",this.message=t||""};e.prototype=Error.prototype;var n=function(i,o,r,s){if(!(this instanceof n))throw new Error("Contructor function called without new operation");const c=t(i);t(o);if(c&&void 0===o&&(o=i),!t(i))throw new e("low not a number");if(!t(o))throw new e("high not a number");if(i>o)throw new e("low > high");if(i===o&&(r=!0,s=!0),i===-1/0&&(r=!0),o===1/0&&(s=!0),void 0===r&&(r=!0),void 0===s&&(s=!1),"boolean"!=typeof r)throw new e("lowInclude not boolean");if("boolean"!=typeof s)throw new e("highInclude not boolean");this.low=i,this.high=o,this.lowInclude=r,this.highInclude=s,this.length=this.high-this.low,this.singular=this.low===this.high,this.finite=isFinite(this.low)&&isFinite(this.high)};return n.prototype.toString=function(){const t=this.lowInclude?"[":"<",e=this.highInclude?"]":">",n=this.low===-1/0?"<--":this.low,i=this.high===1/0?"--\x3e":this.high;return this.singular?t+n+e:t+n+","+i+e},n.prototype.coversPoint=function(t){return this.low<t&&t<this.high||(!(!this.lowInclude||t!==this.low)||!(!this.highInclude||t!==this.high))},n.prototype.overlapsInterval=function(t){if(t instanceof n==!1)throw new e("paramenter not instance of Interval");return this.singular&&t.singular?this.low===t.low:this.singular?t.coversPoint(this.low):t.singular?this.coversPoint(t.low):!(this.high<t.low)&&(this.high===t.low?this.coversPoint(t.low)&&t.coversPoint(this.high):!(this.low>t.high)&&(this.low!==t.high||this.coversPoint(t.high)&&t.coversPoint(this.low)))},n.prototype.coversInterval=function(t){if(t instanceof n==!1)throw new e("paramenter not instance of Interval");return!(t.low<this.low||this.high<t.high)&&(this.low<t.low&&t.high<this.high||(this.low!==t.low||!1!==this.lowInclude||!0!==t.lowInclude)&&(this.high!==t.high||!1!==this.highInclude||!0!==t.highInclude))},n.prototype.equals=function(t){return this.low===t.low&&(this.high===t.high&&(this.lowInclude===t.lowInclude&&this.highInclude===t.highInclude))},n}),n("sequencing/sortedarraybinary",["../util/interval"],function(t){"use strict";const e=function(t){this.name="SortedArrayError",this.message=t||""};e.prototype=Error.prototype;const n=function(){this.array=[]};return n.prototype.binaryIndexOf=function(t){let e,n,i=0,o=this.array.length-1;for(;i<=o;)if(e=(i+o)/2|0,(n=this.array[e])<t)i=e+1;else{if(!(n>t))return e;o=e-1}return~o},n.prototype.insert=function(t){const e=this.binaryIndexOf(t);(e<0||0===e&&this.array[0]!==t)&&this.array.splice(Math.abs(e),0,t)},n.prototype.indexOf=function(t){const e=this.binaryIndexOf(t);return e<0||0===e&&this.array[0]!==t?-1:e},n.prototype.hasElement=function(t){const e=this.binaryIndexOf(t);return!(e<0||0===e&&this.array[0]!==t)},n.prototype.remove=function(t){const e=this.binaryIndexOf(t);e<0||0===e&&this.array[0]!==t||this.array.splice(e,1)},n.prototype.getMinimum=function(){return this.array.length>0?this.array[0]:null},n.prototype.getMaximum=function(){return this.array.length>0?this.array[this.array.length-1]:null},n.prototype.ltIndexOf=function(t){let e=this.binaryIndexOf(t);return(e=e<0?Math.abs(e)-1:e-1)>=0?e:-1},n.prototype.leIndexOf=function(t){let e=this.binaryIndexOf(t);return e>0||0===e&&this.array[0]===t?e:(e=Math.abs(e)-1)>=0?e:-1},n.prototype.gtIndexOf=function(t){let e=this.binaryIndexOf(t);return 0===e?this.array[0]===t&&(e=1):e=e<0?Math.abs(e):e+1,e<this.array.length?e:-1},n.prototype.geIndexOf=function(t){let e=this.binaryIndexOf(t);return e>0||0===e&&this.array[0]===t?e:(e=Math.abs(e))<this.array.length?e:-1},n.prototype.lookup=function(n){if(void 0===n&&(n=new t(-1/0,1/0,!0,!0)),n instanceof t==!1)throw new e("lookup requires Interval argument");let i=-1,o=-1;return-1===(i=n.lowInclude?this.geIndexOf(n.low):this.gtIndexOf(n.low))?[]:-1===(o=n.highInclude?this.leIndexOf(n.high):this.ltIndexOf(n.high))?[]:this.array.slice(i,o+1)},n.prototype.get=function(t){return this.array[t]},n.prototype.list=function(){return this.array},n}),n("sequencing/multimap",[],function(){"use strict";const t=function(){this._map={}};return t.prototype.insert=function(t,e){return this.insertAll([{key:t,value:e}])},t.prototype.insertAll=function(t){let e;const n=[];return t.forEach(function(t){this._map.hasOwnProperty(t.key)||(this._map[t.key]=[]),-1===(e=this._map[t.key]).indexOf(t.value)&&(e.push(t.value),n.push(t))},this),n},t.prototype.remove=function(t,e){return this.removeAll([{key:t,value:e}])},t.prototype.removeAll=function(t){let e,n;const i=[];return t.forEach(function(t){this._map.hasOwnProperty(t.key)&&(n=this._map[t.key],(e=n.indexOf(t.value))>-1&&(n.splice(e,1),i.push(t),0===n.length&&delete this._map[t.key]))},this),i},t.prototype.hasKey=function(t){return this._map.hasOwnProperty(t)},t.prototype.keys=function(){return Object.keys(this._map)},t.prototype.getItemsByKey=function(t){const e=[];return this.hasKey(t)&&this._map[t].forEach(function(n){e.push({key:t,value:n})}),e},t.prototype.getItemsByKeys=function(t){void 0===t&&(t=this.keys());let e=[];return t.forEach(function(t){e=e.concat(this.getItemsByKey(t))},this),e},t.prototype.list=t.prototype.getItemsByKeys,t}),n("sequencing/axis",["../util/interval","./sortedarraybinary","./multimap","../util/eventify"],function(t,e,n,i){"use strict";const o=function(t){this.name="AxisError",this.message=t||""};o.prototype=Error.prototype;const r=Object.freeze({INIT:"init",NONE:"none",ADD:"add",UPDATE:"update",REPEAT:"repeat",REMOVE:"remove"});var s=Object.freeze({LOW:"low",SINGULAR:"singular",HIGH:"high",INSIDE:"inside",OUTSIDE:"outside",toInteger:function(t){if(t===s.LOW)return-1;if(t===s.HIGH)return 1;if(t===s.INSIDE)return 2;if(t===s.OUTSIDE)return 3;if(t===s.SINGULAR)return 0;throw new o("illegal string value for point type")},fromInteger:function(t){if(-1===t)return s.LOW;if(0===t)return s.SINGULAR;if(1===t)return s.HIGH;if(2===t)return s.INSIDE;if(3===t)return s.OUTSIDE;throw new o("illegal integer value for point type")}});const c=function(){this._map={},this._reverse=new n,this._index=new e,this._cache={},i.eventifyInstance(this),this.eventifyDefineEvent("change",{init:!0})};return i.eventifyPrototype(c.prototype),c.prototype.eventifyMakeInitEvents=function(t){return"change"===t?this.items().map(function(t){return t.type="add",t}):[]},c.prototype._remove=function(t){if(this._map.hasOwnProperty(t)){const e=this._map[t];let n;return delete this._map[t],this._reverse.remove(e.low,t),this._reverse.remove(e.high,t),this._reverse.hasKey(e.low)||this._index.remove(e.low),this._reverse.hasKey(e.high)||this._index.remove(e.high),this._cache.hasOwnProperty(t)&&(n=this._cache[t],delete this._cache[t]),{type:r.REMOVE,key:t,interval:e,data:n}}return{type:r.NONE,key:t,interval:void 0,data:void 0}},c.prototype._insert=function(t,e,n){const i={key:t,interval:e,data:n};return this._map.hasOwnProperty(t)?(i.old_interval=this._map[t],i.old_data=this._cache[t],this._remove(t),e.equals(i.old_interval)?i.type=r.REPEAT:i.type=r.UPDATE):i.type=r.ADD,this._map[t]=e,this._reverse.hasKey(e.low)||this._index.insert(e.low),this._reverse.hasKey(e.high)||this._index.insert(e.high),this._reverse.insert(e.low,t),this._reverse.insert(e.high,t),this._cache[t]=n,i},c.prototype.updateAll=function(e){let n;const i=[];let r,s,c;return e.forEach(function(e){if(r=e.key,s=e.interval,c=e.data,"string"!=typeof r)throw new o("key is "+typeof r+" - must be string");if(void 0===s)n=this._remove(r);else{if(s instanceof t==!1)throw new o("parameter must be instanceof Interval");n=this._insert(r,s,c)}this.eventifyTriggerEvent("change",n),i.push(n)},this),i},c.prototype.update=function(t,e,n){return this.updateAll([{key:t,interval:e,data:n}])},c.prototype.lookupKeysByPoint=function(t){let e;const n={};return void 0===t?Object.keys(this._map).forEach(function(t){n[t]=void 0}):Object.keys(this._map).forEach(function(i){(e=this._map[i]).coversPoint(t)&&(n[i]=void 0)},this),n},c.prototype.lookupKeysByInterval=function(e){const n={};this._index.lookup(e).forEach(function(t){this._reverse.getItemsByKey(t).forEach(function(t){n[t.value]=void 0})},this);const i=new t(-1/0,e.low),o=new t(e.high,1/0);return this._index.lookup(i).forEach(function(t){this._reverse.getItemsByKey(t).forEach(function(t){const e=this._map[t.value];o.coversPoint(e.high)&&(n[t.value]=void 0)},this)},this),n},c.prototype.lookupByPoint=function(t){let e;const n=[];return Object.keys(this._map).forEach(function(i){e=this._map[i],(void 0===t||e.coversPoint(t))&&n.push({key:i,interval:e,data:this._cache[i]})},this),n},c.prototype.lookupByInterval=function(t){const e=[];return this._index.lookup(t).forEach(function(n){this._reverse.getItemsByKey(n).forEach(function(i){n=i.key,t=this._map[i.value],e.push({key:i.value,interval:t,data:this._cache[i.value],point:n,pointType:this.getPointType(n,t)})},this)},this),e},c.prototype.items=function(){return this.lookupByPoint()},c.prototype.keys=function(){return Object.keys(this._map)},c.prototype.getItem=function(t){return this._map.hasOwnProperty(t)?{key:t,interval:this._map[t],data:this._cache[t]}:null},c.prototype.getInterval=function(t){return this._map.hasOwnProperty(t)?this._map[t]:null},c.prototype.getPointType=function(t,e){return e.singular&&t===e.low?s.SINGULAR:t===e.low?s.LOW:t===e.high?s.HIGH:e.low<t&&t<e.high?s.INSIDE:s.OUTSIDE},c.prototype.hasKey=function(t){return this._map.hasOwnProperty(t)},{Axis:c,OpType:r,PointType:s}}),n("sequencing/sequencer",["../util/motionutils","../util/eventify","../util/interval","./axis"],function(t,e,n,i){"use strict";const o=function(t){return 0!==t.velocity||0!==t.acceleration};var r=Object.freeze({ENTER:"enter",EXIT:"exit",NONE:"none",toInteger:function(t){if(t===r.ENTER)return 1;if(t===r.EXIT)return-1;if(t===r.NONE)return 0;throw new u("illegal string value verb type "+t)},fromInteger:function(t){if(-1===t)return r.EXIT;if(1===t)return r.ENTER;if(0===t)return r.NONE;throw new u("illegal integer value for direction type "+t)}}),s=Object.freeze({BACKWARDS:"backwards",FORWARDS:"forwards",NODIRECTION:"nodirection",toInteger:function(t){if(t===s.BACKWARDS)return-1;if(t===s.FORWARDS)return 1;if(t===s.NODIRECTION)return 0;throw new u("illegal string value direction type "+string)},fromInteger:function(t){if(0===t)return s.NODIRECTION;if(-1===t)return s.BACKWARDS;if(1===t)return s.FORWARDS;throw new u("illegal integer value for direction type"+t+" "+typeof t)}});const c=i.OpType,a=function(t,e){this.queue=[],this.options=e||{},this.options.lookahead=this.options.lookahead||5;const i=t,o=t+this.options.lookahead;this.timeInterval=new n(i,o,!0,!0),this.posInterval=null};a.prototype.getTimeInterval=function(){return this.timeInterval},a.prototype.getPosInterval=function(){return this.posInterval},a.prototype.setPosInterval=function(t){this.posInterval=t},a.prototype.sortFunc=function(t,e){return t.ts-e.ts},a.prototype.push=function(t,e,n){if(this.timeInterval.coversPoint(e)){const i={ts:e,task:n,push_ts:t};if(e>=t)return this.queue.push(i),this.queue.sort(this.sortFunc),!0;console.log("Schedule : task pushed a bit too late, ts < now ",e-t)}return!1},a.prototype.pop=function(t){const e=[];for(;this.queue.length>0&&this.queue[0].ts<=t;){const n=this.queue.shift(),i={task:n.task,pop_ts:t,push_ts:n.push_ts,ts:n.ts};e.push(i)}return e},a.prototype.invalidate=function(t){let e,n,i;const o=[];for(e=0;e<this.queue.length;e++)(i=this.queue[e]).task.key===t&&o.push(i);for(e=0;e<o.length;e++)i=o[e],(n=this.queue.indexOf(i))>-1&&this.queue.splice(n,1)},a.prototype.advance=function(t){t<this.timeInterval.low&&console.log("Schedule : Advancing backwards "+(t-this.timeInterval.low));const e=t,i=t+this.options.lookahead;this.queue=[],this.timeInterval=new n(e,i,!1,!0),this.posInterval=null},a.prototype.isExpired=function(t){return t>this.timeInterval.high},a.prototype.getDelayNextTs=function(t){return this.queue.length>0?Math.max(0,this.queue[0].ts-t):Math.max(0,this.timeInterval.high-t)},a.prototype.getNextTaskPoint=function(){return this.queue.length>0?this.queue[0].task.point:null};var u=function(t){this.name="SequencerError",this.message=t||""};u.prototype=Error.prototype;const h=function(t,e,n,i,o,a,u,h,l,p){const f=s.fromInteger(o),y=t._axis.getPointType(a,n);this.src=t,this.key=e,this.interval=n,this.data=i,this.point=a,this.pointType=y,this.dueTs=h,this.delay=u-h,this.directionType=f,this.type=p===r.EXIT?"remove":"change",this.cause=function(t){return t===c.INIT?"init":t===c.NONE?"motion":t===c.ADD?"add":t===c.UPDATE||t===c.REPEAT?"update":t===c.REMOVE?"remove":""}(l),this.enter=p===r.ENTER,this.exit=p===r.EXIT};h.prototype.toString=function(){let t="["+this.point.toFixed(2)+"]";t+=" "+this.key,t+=" "+this.interval.toString(),t+=" "+this.type;let e="none";return this.enter?e="enter":this.exit&&(e="exit"),t+=" ("+this.cause+","+e+")",t+=" "+this.directionType,t+=" "+this.pointType,t+=" delay:"+this.delay.toFixed(4),this.data&&(t+=" "+JSON.stringify(this.data)),t};const l=function(t){this.key=t.key,this.interval=t.interval,this.data=t.data};l.prototype.toString=function(){let t=this.key+" "+this.interval.toString();return this.data&&(t+=" "+JSON.stringify(this.data)),t};var p=function(t,n){if(!(this instanceof p))throw new Error("Contructor function called without new operation");this._to=t,this._axis=n||new i.Axis,this._schedule=null,this._timeout=null,this._currentTimeoutPoint=null,this._activeKeys={},this._first=!1,this._ready=new e.EventBoolean(!1,{init:!0}),e.eventifyInstance(this),this.eventifyDefineEvent("change",{init:!0}),this.eventifyDefineEvent("remove"),this._wrappedOnTimingChange=function(){this._onTimingChange()},this._wrappedOnAxisChange=function(t){const e=t.map(function(t){return t.e});this._onAxisChange(e)},this._to.on("change",this._wrappedOnTimingChange,this)};e.eventifyPrototype(p.prototype),Object.defineProperty(p.prototype,"Interval",{get:function(){return n}}),p.prototype.isReady=function(){return this._ready.value},Object.defineProperty(p.prototype,"ready",{get:function(){const t=this;return new Promise(function(e,n){if(!0===t._ready.value)e();else{var i=function(){!0===t._ready.value&&(t._ready.off("change",i),e())};t._ready.on("change",i)}})}}),p.prototype.eventifyMakeInitEvents=function(t){return"change"===t&&this._ready.value?this._processInitialEvents():[]},p.prototype._onTimingChange=function(e){const r=this._to.clock.now(),c=this._to.vector;if(!1===this._first)return this._schedule=new a(r),this._axis.on("events",this._wrappedOnAxisChange,this),this._first=!0,this._load(r),void this._main(r);if(!1===this._ready.value)return;this._schedule.advance(r);const u=t.calculateVector(c,r),h=this._axis.lookupKeysByPoint(u.position),l=Object.keys(this._activeKeys).filter(function(t){return!h.hasOwnProperty(t)}),p=Object.keys(h).filter(function(t){return!this._activeKeys.hasOwnProperty(t)},this);if(o(c)){const e=u.position;this._axis.lookupByInterval(new n(e,e,!0,!0)).forEach(function(e){if(e.pointType===i.PointType.SINGULAR)l.push(e.key);else{const n=e.interval;let o=!1;e.pointType===i.PointType.LOW&&n.lowInclude?o=!0:e.pointType===i.PointType.HIGH&&n.highInclude&&(o=!0);const a=s.fromInteger(t.calculateDirection(c,r));let u=!0;e.pointType===i.PointType.LOW&&a===s.BACKWARDS&&(u=!1),e.pointType===i.PointType.HIGH&&a===s.FORWARDS&&(u=!1),!u&&o&&l.push(e.key),u&&!o&&p.push(e.key)}},this)}const f=l.map(function(t){return this._axis.getItem(t)},this),y=p.map(function(t){return this._axis.getItem(t)},this),v=this._processIntervalEvents(r,f,y,[]);this.eventifyTriggerEvents(v),this._load(r),this._main(r)},p.prototype.updateAll=function(t){this._axis.updateAll(t)};return p.prototype._onAxisChange=function(e){const n=this;!1===this._ready.value&&(this._ready.value=!0),e=function(t){if(t.length<2)return t;const e=[];let n;const i={};for(var o=0;o<t.length;o++)i[(n=t[o]).key]=o;for(o=0;o<t.length;o++)i[(n=t[o]).key]===o&&e.push(n);return e}(e=e.filter(function(t){return t.type!==c.NONE}));const r=this._to.clock.now(),s=t.calculateVector(this._to.vector,r),a=s.position,u=[],h=[];let l,p;const f=e.filter(function(t){return t.type!==c.REPEAT});let y,v,_;f.forEach(function(t){v=t.interval,y=t.key,_=t.data,l=this.isActive(y),p=!1,t.type!==c.ADD&&t.type!==c.UPDATE||v.coversPoint(a)&&(p=!0),l&&!p?h.push({key:y,interval:v,data:_,opType:t.type}):!l&&p&&u.push({key:y,interval:v,data:_,opType:t.type})},this);const g=h.map(function(t){return t.key}),d=e.filter(function(t){return this.isActive(t.key)&&-1===g.indexOf(t.key)},this).map(function(t){return{key:t.key,interval:t.interval,data:t.data}},this);if(0===f.length){if(d.length>0){var m=n._processIntervalEvents(r,[],[],d);n.eventifyTriggerEvents(m)}return}const w=o(s);if(w){if(w){f.forEach(function(t){this._schedule.invalidate(t.key)},this);const t=[];f.forEach(function(e){if(v=e.interval,y=e.key,_=e.data,e.type!==c.REMOVE&&w){const e={key:y,interval:v,data:_},n=this._schedule.getPosInterval();null!==n&&(n.coversPoint(v.low)&&(e.point=v.low),n.coversPoint(v.high)&&(e.point=v.high),e.pointType=this._axis.getPointType(e.point,e.interval),e.pointType!==i.PointType.OUTSIDE&&t.push(e))}},this),t.length>0&&this._load(r,t)}else this._schedule.advance(r);m=n._processIntervalEvents(r,h,u,d);n.eventifyTriggerEvents(m),n._main(r)}else{var m=n._processIntervalEvents(r,h,u,d);n.eventifyTriggerEvents(m)}},p.prototype._main=function(t,e){let n;t=t||this._to.clock.now(),n=this._processScheduleEvents(t,this._schedule.pop(t)),this.eventifyTriggerEvents(n);const i=o(this._to.vector);if(i&&this._schedule.isExpired(t)&&(t=this._schedule.getTimeInterval().high,this._schedule.advance(t),this._load(t),n=this._processScheduleEvents(t,this._schedule.pop(t)),this.eventifyTriggerEvents(n)),i){let t=!1;if(null===this._timeout)t=!0;else{var r=this._schedule.getNextTaskPoint();null===r||r===this._currentTimeoutPoint||(t=!0)}if(t){this._clearTimeout();const t=this._to.clock.now(),e=this._schedule.getDelayNextTs(t);this._currentTimeoutPoint=r;const n=this;this._timeout=this._to.clock.setTimeout(function(){n._clearTimeout(),n._main(void 0,!0)},e,{anchor:t,early:.005})}}},p.prototype._clearTimeout=function(){this._currentTimeoutPoint=null,null!==this._timeout&&(this._timeout.cancel(),this._timeout=null)},p.prototype._load=function(e,r){const s=this._to.vector;if(!o(s))return;const c=this._schedule.getTimeInterval(),a=c.low,u=(c.high,c.length),h=this._to.range,l=t.calculateVector(s,a);let p=r;if(!p){const e=t.calculateInterval(l,u),i=Math.round10(Math.max(e[0],h[0]),-10),o=Math.round10(Math.min(e[1],h[1]),-10),r=new n(i,o,!1,!0);this._schedule.setPosInterval(r),p=this._axis.lookupByInterval(r)}const f=t.calculateSolutionsInInterval(l,u,p);p.length!==f.length&&console.log("warning : mismatch points and events",p.length,f.length);const y=t.calculateDelta(l,h)[0];f.forEach(function(n){const o=n[0],r=n[1];let c=!0;if(a+o<e&&(c=!1),0===o&&(console.log("drop - exactly at start of time covering"),c=!1),o>y&&(console.log("drop - events after range violations"),c=!1),o===y&&(console.log("drop - events exactly at range point"),c=!1),r.pointType===i.PointType.LOW||r.pointType===i.PointType.HIGH){0===t.calculateVector(s,a+o).velocity&&(console.log("drop - touch endpoint during acceleration"),c=!1)}c&&this._schedule.push(e,a+o,r)},this)},p.prototype._processScheduleEvents=function(e,n){const o=[],a=t.calculateVector(this._to.vector,e),u=t.calculateDirection(a,e),l=this._to.clock.now();return n.forEach(function(t){if(t.task.interval.singular)o.push(new h(this,t.task.key,t.task.interval,t.task.data,u,t.task.point,l,t.ts,c.NONE,r.ENTER)),o.push(new h(this,t.task.key,t.task.interval,t.task.data,u,t.task.point,l,t.ts,c.NONE,r.EXIT));else{s.fromInteger(u);const e=this._axis.getPointType(t.task.point,t.task.interval),n=i.PointType.toInteger(e)*u*-1,a=r.fromInteger(n);o.push(new h(this,t.task.key,t.task.interval,t.task.data,u,t.task.point,l,t.ts,c.NONE,a))}},this),this._makeEvents(e,o,u)},p.prototype._processIntervalEvents=function(e,n,i,o){if(n.length+i.length+o.length===0)return[];const s=t.calculateVector(this._to.vector,e),a=t.calculateDirection(s,e),u=this._to.clock.now(),l=[];let p;return n.forEach(function(t){p=t.opType||c.NONE,l.push(new h(this,t.key,t.interval,t.data,a,s.position,u,e,p,r.EXIT))},this),i.forEach(function(t){p=t.opType||c.NONE,l.push(new h(this,t.key,t.interval,t.data,a,s.position,u,e,p,r.ENTER))},this),o.forEach(function(t){l.push(new h(this,t.key,t.interval,t.data,a,s.position,u,e,c.UPDATE,r.NONE))},this),this._makeEvents(e,l,a)},p.prototype._processInitialEvents=function(){let e,n;const i=this._to.clock.now(),o=t.calculateVector(this._to.vector,i),s=t.calculateDirection(o,i),a=this._to.clock.now();return Object.keys(this._activeKeys).map(function(t){return e=this._axis.getItem(t),n=new h(this,t,e.interval,e.data,s,o.position,a,i,c.INIT,r.ENTER)},this).sort(function(t,e){return t.interval.low-e.interval.low})},p.prototype._makeEvents=function(t,e,n){if(0===e.length)return[];let i=[];return e.forEach(function(t){t.exit&&this._activeKeys.hasOwnProperty(t.key)&&delete this._activeKeys[t.key],t.enter&&(this._activeKeys.hasOwnProperty(t.key)||(this._activeKeys[t.key]=void 0)),i.push(t)},this),(i=this._reorderEventList(i,n)).map(function(t){return{type:t.type,e:t}})},p.prototype._reorderEventList=function(t,e){if(t.length<2)return t;let n,o,s=[],c={a:[],x:[],b:[],c:[],y:[],d:[]};return t.sort(function(t,e){return t.interval.low-e.interval.low}).forEach(function(t){if(t.point===n&&t.dueTs===o||(s=e>=0?s.concat(c.a,c.x,c.b,c.c,c.y,c.d):s.concat(c.d,c.y,c.c,c.b,c.x,c.a),c={a:[],x:[],b:[],c:[],y:[],d:[]},n=t.point,o=t.dueTs),t.pointType===i.PointType.SINGULAR)t.type===r.ENTER?c.b.push(t):c.c.push(t);else{let e=!1;t.pointType===i.PointType.LOW&&t.interval.lowInclude?e=!0:t.pointType===i.PointType.HIGH&&t.interval.highInclude&&(e=!0),t.type===r.ENTER?e?c.x.push(t):c.d.push(t):e?c.y.push(t):c.a.push(t)}},this),e>=0?s.concat(c.a,c.x,c.b,c.c,c.y,c.d):s.concat(c.d,c.y,c.c,c.b,c.x,c.a)},p.prototype.addCue=function(t,e,n){return this.updateAll([{key:t,interval:e,data:n}])},p.prototype.removeCue=function(t,e){return this.updateAll([{key:t,interval:void 0,data:e}])},p.prototype.hasCue=function(t){return this._axis.hasKey(t)},p.prototype.keys=function(){return this._axis.keys()},p.prototype.getCue=function(t){if(this._axis.hasKey(t))return new l(this._axis.getItem(t))},p.prototype.getCues=function(){return this.keys().map(function(t){return this.getCue(t)},this)},p.prototype.isActive=function(t){return this._activeKeys.hasOwnProperty(t)},p.prototype.getActiveKeys=function(){return Object.keys(this._activeKeys)},p.prototype.getActiveCues=function(){return Object.keys(this._activeKeys).map(function(t){return this.getCue(t)},this)},p.prototype.get=function(t){return this.isActive(t)?this.getCues(t).map(function(t){return t.data}):void 0},p.prototype.items=function(){return this.getActiveCues().map(function(t){return t.data})},p.prototype.getCuesByPoint=function(t){return this._axis.lookupByPoint(t).map(function(t){return this.getCue(t.key)},this)},p.prototype.getCuesByInterval=function(t){const e={};return this._axis.lookupByInterval(t).forEach(function(t){e[t.key]=t.interval}),Object.keys(e).map(function(t){return this.getCue(t)},this).filter(function(e){return t.overlapsInterval(e.interval)},this)},p.prototype.getCuesCoveredByInterval=function(t){return this.getCuesByInterval(t).filter(function(e){return!!t.coversInterval(e.interval)},this)},p.prototype.close=function(){this._to.off("change",this._wrappedOnTimingChange,this),this._axis.off("change",this._wrappedOnAxisChange,this),null!==this._timeout&&(this._timeout.cancel(),this._timeout=null)},{Interval:n,DefaultSequencer:p,Axis:i.Axis,SequencerError:u}}),n("sequencing/windowsequencer",["../util/eventify","../util/motionutils","./axis","./sequencer"],function(t,e,n,i){"use strict";const o=i.Interval,r=i.DefaultSequencer;var s=function(e,i,o){if(!(this instanceof s))throw new Error("Contructor function called without new operation");this._axis=o||new n.Axis,this._toA=e,this._toB=i,this._seqA=new r(this._toA,this._axis),this._seqB=new r(this._toB,this._axis),this._ready=new t.EventBoolean(!1,{init:!0}),this._pending_reevaluate=!1,this._activeKeys={},t.eventifyInstance(this),this.eventifyDefineEvent("change",{init:!0}),this.eventifyDefineEvent("remove");const c=this;this._onAxisChange=function(t){const e=t.map(function(t){return t.e});c._reevaluate(e)},this._onToAChange=function(){c._request_reevaluate()},this._onToBChange=function(){c._request_reevaluate()},this._onSeqAChange=function(t){c._request_reevaluate()},this._onSeqBChange=function(t){c._request_reevaluate()},this._toA.on("change",this._onToAChange,this),this._toB.on("change",this._onToBChange,this),this._seqA.on("events",this._onSeqAChange,this),this._seqB.on("events",this._onSeqBChange,this),Promise.all([this._seqA.ready,this._seqB.ready]).then(function(t){c._axis.on("events",c._onAxisChange,c),c._ready.value=!0})};t.eventifyPrototype(s.prototype),Object.defineProperty(s.prototype,"Interval",{get:function(){return o}}),s.prototype.isReady=function(){return!0===this._ready.value},Object.defineProperty(s.prototype,"ready",{get:function(){const t=this;return new Promise(function(e,n){if(!0===t._ready.value)e();else{var i=function(){!0===t._ready.value&&(t._ready.off("change",i),e())};t._ready.on("change",i)}})}}),s.prototype.eventifyMakeInitEvents=function(t){return"change"===t?Object.keys(this._activeKeys).map(function(t){const e=this._axis.getItem(t);return{key:t,interval:e.interval,data:e.data,type:"change",cause:"init",enter:!0,exit:!1}},this):[]},s.prototype._getActiveInterval=function(){const t=this._toA.query(),e=this._toB.query(),n=Math.min(t.position,e.position),i=Math.max(t.position,e.position);return new o(n,i,!0,!0)};return s.prototype._getOpFromAxisOpList=function(t,e){let n;if(t)for(let i=0;i<t.length;i++){const o=t[i];if(o.key===e){n=o;break}}return n},s.prototype._getItem=function(t,e){let n;var i;return t?null==(n=this._getOpFromAxisOpList(t,e))&&(null==(n=this._axis.getItem(e))?n={key:e,interval:void 0,data:void 0,type:"remove"}:n.type="add"):(n=this._axis.getItem(e)).type="none",n.type="init"===(i=n.type)?"init":"none"===i?"motion":"add"===i?"add":"update"===i||"repeat"===i?"update":"remove"===i?"remove":"",n},s.prototype._request_reevaluate=function(){if(0==this._pending_reevaluate){this._pending_reevaluate=!0;const t=this;setTimeout(function(){t._pending_reevaluate=!1,t._reevaluate()},0)}},s.prototype._reevaluate=function(t){if(!1===this._ready.value)return[];const e=this._getActiveInterval(),n=this._axis.lookupKeysByInterval(e),i=Object.keys(this._activeKeys).filter(function(t){return!n.hasOwnProperty(t)}),o=Object.keys(n).filter(function(t){return!this._activeKeys.hasOwnProperty(t)},this),r=[];let s;t&&t.forEach(function(t){this._activeKeys.hasOwnProperty(t.key)&&n.hasOwnProperty(t.key)&&r.push(t.key)},this),this._activeKeys=n;const c=[];i.forEach(function(e){s=this._getItem(t,e),c.push({type:"remove",e:{key:e,interval:s.interval,type:"remove",data:s.data,cause:s.type,enter:!1,exit:!0}})},this),o.forEach(function(e){s=this._getItem(t,e),c.push({type:"change",e:{key:e,interval:s.interval,type:"change",data:s.data,cause:s.type,enter:!0,exit:!1}})},this),r.forEach(function(e){s=this._getItem(t,e),c.push({type:"change",e:{key:e,interval:s.interval,type:"change",data:s.data,cause:s.type,enter:!1,exit:!1}})},this),this.eventifyTriggerEvents(c)},s.prototype.addCue=function(t,e,n){return this._seqA.addCue(t,e,n)},s.prototype.removeCue=function(t){return this._seqA.removeCue(t)},s.prototype.hasCue=function(t){return this._seqA.hasCue(t)},s.prototype.keys=function(){return this._seqA.keys()},s.prototype.getCue=function(t){return this._seqA.getCue(t)},s.prototype.getCues=function(){return this._seqA.getCues()},s.prototype.isActive=function(t){return this._activeKeys.hasOwnProperty(t)},s.prototype.getActiveKeys=function(){return Object.keys(this._activeKeys)},s.prototype.getActiveCues=function(){return Object.keys(this._activeKeys).map(function(t){return this.getCue(t)},this)},s.prototype.get=function(t){return this.isActive(t)?this.getCues(t).map(function(t){return t.data}):void 0},s.prototype.items=function(){return this.getActiveCues().map(function(t){return t.data})},s.prototype.getCuesByPoint=function(t){return this._seqA.getCuesByPoint(t)},s.prototype.getCuesByInterval=function(t){return this._seqA.getCuesByInterval(t)},s.prototype.getCuesCoveredByInterval=function(t){return this._seqA.getCuesCoveredByInterval(t)},s.prototype.close=function(){this._axis.off("change",this._onAxisChange),this._toA.off("change",this._onToAChange),this._toB.off("change",this._onToBChange),this._seqA.off("events",this._onSeqAChange),this._seqB.off("events",this._onSeqBChange),this._seqA.close(),this._seqB.close()},s}),n("sequencing/timingcallbacks",["../util/motionutils"],function(t){"use strict";const e=function(t,e){const n=function(){};n.prototype=e.prototype,t.prototype=new n,t.uber=e.prototype,t.prototype.constructor=t},n=function(t,e){this._timingsrc=t,this._handler=e,this._timeout=null,this._wrappedOnChange=function(){this._onChange()},this.timingsrc=t};n.prototype._renewTimeout=function(){this._clearTimeout();const t=this._calculateTimeout();if(null===t.delay)return null;const e=this;this._timeout=this._timingsrc.clock.setTimeout(function(){e._onTimeout()},t.delay,{anchor:t.anchor,early:.005})},n.prototype._clearTimeout=function(){null!==this._timeout&&(this._timeout.cancel(),this._timeout=null)},n.prototype.cancel=function(){this._clearTimeout(),this._timingsrc.off("change",this._wrappedOnChange,this)},Object.defineProperty(n.prototype,"timingsrc",{get:function(){return this._timingsrc},set:function(t){this._timingsrc&&this._timingsrc.off("change",this._wrappedOnChange,this),clearTimeout(this._tid),this._timingsrc=t,this._timingsrc.on("change",this._wrappedOnChange,this)}});var i=function(t,e,o,r){if(!(this instanceof i))throw new Error("Contructor function called without new operation");n.call(this,t,e),this._options=r||{},this._options.repeat=void 0!==this._options.repeat&&this._options.repeat,this._point=o};e(i,n),i.prototype._onChange=function(){this._timingsrc.query().position===this._point&&this._handler(),this._renewTimeout()},i.prototype._onTimeout=function(){this._options.repeat||this.cancel(),this._handler(),this._renewTimeout()},i.prototype._calculateTimeout=function(){const e=this._timingsrc.query(),n=t.calculateMinPositiveRealSolution(e,this._point);return{anchor:e.timestamp,delay:n}};var o=function(t,e,i,r){if(!(this instanceof o))throw new Error("Contructor function called without new operation");n.call(this,t,e),this._options=r||{},this._options.offset=void 0!==this._options.offset?this._options.offset:0,this._length=i};return e(o,n),o.prototype._mod=function(t,e){return(t%e+e)%e},o.prototype._getPoint=function(t){const e=this._options.offset;return{n:Math.floor((t-e)/this._length),offset:this._mod(t-e,this._length)}},o.prototype._getFloat=function(t){return this._options.offset+t.n*this._length+t.offset},o.prototype._onChange=function(){this._calculatePoints(this._timingsrc.query().position).isTarget&&this._handler(),this._renewTimeout()},o.prototype._onTimeout=function(){this._handler(),this._renewTimeout()},o.prototype._calculatePoints=function(t){const e={},n={};let i;const o=this._getPoint(t);return 0===o.offset?(i=!0,e.n=o.n-1,e.offset=o.offset,n.n=o.n+1,n.offset=o.offset):(i=!1,e.n=o.n,e.offset=0,n.n=o.n+1,n.offset=0),{isTarget:i,before:this._getFloat(e),after:this._getFloat(n)}},o.prototype._calculateTimeout=function(){const e=this._timingsrc.query(),n=this._calculatePoints(e.position),i=t.calculateDelta(e,[n.before,n.after])[0];return{anchor:e.timestamp,delay:i}},{setPointCallback:function(t,e,n,o){return new i(t,e,n,o)},setIntervalCallback:function(t,e,n,i){return new o(t,e,n,i)}}}),n("sequencing/timinginteger",["../util/motionutils","../util/eventify"],function(t,e){const n=function(t){return!Array.isArray(t)&&t-parseFloat(t)+1>=0},i=function(t,i){if(this._timingsrc,void 0===(i=i||{}).value&&(i.value=0),!n(i.value))throw new Error("value not nummeric",i.value);if(this._value=i.value,void 0!==i.min&&!n(i.min))throw new Error("option.min not nummeric",i.min);if(void 0!==i.max&&!n(i.max))throw new Error("option.min not nummeric",i.max);this._options=i,e.eventifyInstance(this),this.eventifyDefineEvent("change",{init:!0}),this._timeout=null;const o=this;this._wrappedOnChange=function(){o._onChange()},this.timingsrc=t};return e.eventifyPrototype(i.prototype),i.prototype.eventifyMakeInitEvents=function(t){return"change"===t?[this.value]:[]},Object.defineProperty(i.prototype,"ready",{get:function(){return this._timingsrc.ready}}),i.prototype.isReady=function(){return this._timingsrc.isReady()},Object.defineProperty(i.prototype,"value",{get:function(){return this._value},set:function(t){this._timingsrc.update({position:t})}}),Object.defineProperty(i.prototype,"timingsrc",{get:function(){return this._timingsrc},set:function(t){this._timingsrc&&this._timingsrc.off("change",this._wrappedOnChange,this),clearTimeout(this._tid),this._timingsrc=t,this._timingsrc.on("change",this._wrappedOnChange,this)}}),i.prototype._renewTimeout=function(){this._clearTimeout();const t=this._calculateTimeout();if(null===t.delay)return null;const e=this;this._timeout=this._timingsrc.clock.setTimeout(function(){e._onTimeout()},t.delay,{anchor:t.anchor,early:.005})},i.prototype._clearTimeout=function(){null!==this._timeout&&(this._timeout.cancel(),this._timeout=null)},i.prototype._onChange=function(){this._refresh(),this._renewTimeout()},i.prototype._onTimeout=function(){this._refresh(),this._renewTimeout()},i.prototype._refresh=function(){let t=Math.floor(this._timingsrc.query().position);void 0!==this._options.max&&t>this._options.max&&(t=this._options.max),void 0!==this._options.min&&t<this._options.min&&(t=this._options.min),t!==this._value&&(this._value=t,this.eventifyTriggerEvent("change",this.value))},i.prototype._calculatePoints=function(t){let e,n;const i=Number.isInteger(t);return!0===i?(e=t-1,n=t+1):n=(e=Math.floor(t))+1,{isTarget:i,before:e,after:n}},i.prototype._calculateTimeout=function(){const e=this._timingsrc.query(),n=this._calculatePoints(e.position),i=t.calculateDelta(e,[n.before,n.after])[0];return{anchor:e.timestamp,delay:i}},i.prototype.close=function(){this._clearTimeout(),this._timingsrc&&(this._timingsrc.off("change",this._wrappedOnChange,this),this._timingsrc=void 0)},i}),n("sequencing/activecue",["../util/eventify"],function(t){const e=function(e){this._seq=e,this._stack=[],this._dirty=!1,this._value=void 0,t.eventifyInstance(this),this.eventifyDefineEvent("change",{init:!0});const n=this;this._wrappedHandler=function(t){n._onSeqEvents(t)},this._seq.on("events",this._wrappedHandler)};return t.eventifyPrototype(e.prototype),e.prototype.eventifyMakeInitEvents=function(t){return"change"===t?[this._value]:[]},e.prototype._touch=function(){if(!this._dirty){const t=this;Promise.resolve().then(function(){t._refresh()})}this._dirty=!0},e.prototype._refresh=function(){const t=this._stack.length,e=t>0?this._stack[t-1][1]:void 0;e!==this._value&&(this._value=e,this.eventifyTriggerEvent("change",e)),this._dirty=!1},e.prototype._onSeqEvents=function(t){t.forEach(function(t){const e=t.e;if("change"===t.type)this._stack.push([e.key,e.data]),this._touch();else if("remove"===t.type){const t=this._stack.findIndex(function(t,n,i){return t[0]===e.key});t>-1&&(this._stack.splice(t,1),this._touch())}},this)},Object.defineProperty(e.prototype,"value",{get:function(){return this._value}}),e.prototype.get=function(){return this._value},e.prototype.close=function(){this._seq.off("events",this._wrappedHandler)},e}),n("sequencing/main",["./sequencer","./windowsequencer","./timingcallbacks","./timinginteger","./activecue"],function(t,e,n,i,o){"use strict";const r=function(n,i,o){return void 0===i?new t.DefaultSequencer(n,o):new e(n,i,o)};return t.DefaultSequencer.prototype.clone=function(t,e){return r(t,e,this._axis)},e.prototype.clone=function(t,e){return r(t,e,this._axis)},{Sequencer:r,Interval:t.Interval,inherit:t.inherit,setPointCallback:n.setPointCallback,setIntervalCallback:n.setIntervalCallback,TimingInteger:i,ActiveCue:o}}),n("mediasync/mediasync",[],function(){"use strict";return{mediaSync:function(t,e,n){throw new Error("MediaSync is no longer maintained as part of Timingsrc. Get MediaSync from https://mcorp.no/lib/mediasync.js")},MediaSync:function(t,e,n){throw new Error("MediaSync is no longer maintained as part of Timingsrc. Get MediaSync from https://mcorp.no/lib/mediasync.js")},mediaNeedKick:function(t){throw new Error("MediaSync is no longer maintained as part of Timingsrc. Get MediaSync from https://mcorp.no/lib/mediasync.js")}}}),n("timingsrc",["./timingobject/main","./sequencing/main","./mediasync/mediasync"],function(t,e,n){return{version:"v2",TimingObject:t.TimingObject,ConverterBase:t.ConverterBase,SkewConverter:t.SkewConverter,DelayConverter:t.DelayConverter,ScaleConverter:t.ScaleConverter,LoopConverter:t.LoopConverter,RangeConverter:t.RangeConverter,TimeShiftConverter:t.TimeShiftConverter,LocalConverter:t.LocalConverter,DerivativeConverter:t.DerivativeConverter,Interval:e.Interval,Sequencer:e.Sequencer,setPointCallback:e.setPointCallback,setIntervalCallback:e.setIntervalCallback,TimingInteger:e.TimingInteger,ActiveCue:e.ActiveCue,MediaSync:n.MediaSync,mediaNeedKick:n.needKick}}),e("timingsrc")});